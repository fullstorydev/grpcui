<div id="grpc-form">
  <table class="grpc-desc">
    <tr>
      <td>
        <table id="grpc-desc-selects">
          <!-- service -->
          <tr>
            <td>
              <div class="grpc-form-label">Service name:</div>
            </td>
            <td id="grpc-service-select">
              <select name="grpc-service" id="grpc-service">
                {{ range .Services }}
                <option value="{{.}}">{{.}}</option>
                {{ end }}
              </select>
            </td>
          </tr>
          <!-- method -->
          <tr>
            <td>
              <div class="grpc-form-label">Method name:</div>
            </td>
            <td id="grpc-method-select">
              <select name="grpc-method" id="grpc-method">
                <!-- populated by JavaScript when grpc-service is selected -->
              </select>
            </td>
          </tr>
        </table>
      </td>
      <td id="grpc-descriptions">
        <button id="grpc-descriptions-toggle">Â»</button>
        <pre id="grpc-service-description"></pre>
        <pre id="grpc-method-description"></pre>
        <pre id="grpc-service-description-end"></pre>
      </td>
    </tr>
  </table>

  <div id="grpc-container">
    <div id="grpc-request-examples-container" style="display: none">
      <h3>Examples</h3>
      <ol id="grpc-request-examples"/>
    </div>
    <div id="grpc-request-response">
      <ul>
          <li id="#grpc-request-tab-button"><a href="#grpc-request-tab">Request Form</a></li>
          <li id="#grpc-request-raw-tab-button"><a href="#grpc-request-raw-tab">Raw Request</a></li>
          <li id="#grpc-response-tab-button"><a href="#grpc-response-tab">Response</a></li>
          <li id="#grpc-history-tab-button"><a href="#grpc-history-tab">History</a></li>
      </ul>
      <div class="grpc-tabcontent" id="grpc-request-tab">
        <h3>Request Metadata</h3>
        <div id="grpc-request-metadata">
          <table class="grpc-request-table" id="grpc-request-metadata-form">
              <tr><th></th><th class="name">Name</th><th class="value">Value</th></tr>
              <tr><td><button id="grpc-request-metadata-add-row" class="add">+</button></td><td colspan="2"><span class="add-row-label">Add item</span></td></tr>
          </table>
        </div>

        <h3>Request Data</h3>
        <div id="grpc-request-form"></div>

        <h3>Request Timeout</h3>
        <div id="grpc-request-timeout">
          <input/> seconds
        </div>

        <button class="grpc-invoke" disabled>Invoke</button>
      </div>
      <div class="grpc-tabcontent" id="grpc-request-raw-tab">
        <div class="grpc-request-raw-container">
          <h3>Request payload</h3>
          <textarea id="grpc-request-raw-text"></textarea><br/>
          <button class="grpc-invoke" disabled>Invoke</button>
        </div>
        <hr>
        <div class="grpc-request-raw-container">
          <h3>gRPCurl
              &nbsp;
            <span class="clipboard-container" onclick="copyClipboardText()">
              <svg id="clipboard-copy-buttons" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy">
                <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
              </svg>
              <span id="clipboard-copy-message"  style="display: none;">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check color-fg-success" style="color:rgb(26, 127, 55)">
                <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                <span style="color:rgb(81, 186, 111)">Copied!</span>
              </span>
            </span>
          </h3>

          <div id="grpc-curl" class="grpc-curl-panel">
            <span><pre id="grpc-curl-text"></pre></span>
          </div>
        </div>
      </div>
      <div class="grpc-tabcontent" id="grpc-response-tab">
        <h3>Response Headers</h3>
        <table class="grpc-metadata-table" id="grpc-response-headers"></table>
        <h3>Response Data</h3>
        <div id="grpc-response-req-stats"></div>
        <div class="grpc-response-messages" id="grpc-response-data"></div>
        <div id="grpc-response-error">
          <div id="grpc-response-error-summary">
              <span id="grpc-response-error-desc"></span> <span id="grpc-response-error-num"></span>
          </div>
          <div id = "response-error-extra">
            <span id="grpc-response-error-msg"></span>
            <div id="grpc-response-error-details-container">
              <h4>Error Details:</h4>
              <div class="grpc-response-messages" id="grpc-response-error-details"></div>
            </div>
          </div>
        </div>
        <h3>Response Trailers</h3>
        <table class="grpc-metadata-table" id="grpc-response-trailers"></table>
      </div>
      <div class="grpc-tabcontent" id="grpc-history-tab">
        <button class="grpc-history-clear" id="grpc-history-clear">Clear History</button>
        <button class="grpc-history-save" id="grpc-history-save">Save History</button>
        <div class="grpc-history-list" id="grpc-history-list">
        </div>
      </div>
    </div>
  </div>
</div>

<datalist id="grpc-message-types"></datalist>

<script type="application/javascript">
(function() {
    var services = {
    {{- range .Services}}
        "{{.}}": [
        {{- range $i, $elt := index $.Methods .}}
            "{{$elt}}",
        {{- end}}
        ],
    {{- end}}
    };
    var svcDescs = {
    {{- range $name, $desc := .SvcDescs}}
        "{{$name}}": "{{$desc}}",
    {{- end}}
    };
    var mtdDescs = {
    {{- range $name, $desc := .MtdDescs}}
        "{{$name}}": "{{$desc}}",
    {{- end}}
    };
    var headers = [
    {{- range .DefaultMetadata}}
        {"name": "{{.Name}}", "value": "{{.Value}}"},
    {{- end}}
    ];
    window.target = {{ .Target }};

    initGRPCForm(services, svcDescs, mtdDescs, '{{ .InvokeURI }}', '{{ .MetadataURI }}', {{ .Debug }}, headers);
})();
</script>

<script type="application/javascript">
  function copyClipboardText() {
    // Copy the text to clipboard
    const textToCopy = document.getElementById('grpc-curl-text').innerText;

    // Copy text to clipboard using the Clipboard API
    navigator.clipboard.writeText(textToCopy).then(() => {
      const copyIcon = "clipboard-copy-buttons"
      const successMessage = "clipboard-copy-message"

      // Hide Element A (Copy Icon)
      // Show Element B (Success Icon)
      document.getElementById(copyIcon).style.display = 'none';
      document.getElementById(successMessage).style.display = 'inline';

      // After 5 seconds, revert the visibility of Element A and B
      setTimeout(() => {
        // Show Element A (Copy Icon)
        // Hide Element B (Success Icon)
        document.getElementById(copyIcon).style.display = 'inline';
        document.getElementById(successMessage).style.display = 'none';
      }, 3500); // 3 seconds delay
    }).catch(err => {
      console.error('Failed to copy text: ', err);
    })
  };
</script>
